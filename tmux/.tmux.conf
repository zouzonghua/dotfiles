#===============================================================================
# general
#===============================================================================

set-option -g mouse on
set-option -sg escape-time 10
set-option -g focus-events on
set -g status-interval 5 # default: 15s

# send prefix
# C-b is not acceptable, due to emacs, bash, and vim
unbind-key C-b
set-option -g prefix M-C-x

# True color
# https://gist.github.com/bbqtd/a4ac060d6f6b9ea6fe3aabe735aa9d95
# https://gist.github.com/nicm/ea9cf3c93f22e0246ec858122d9abea1
# fix: Htop Color Error
# 1. git clone https://gist.github.com/nicm/ea9cf3c93f22e0246ec858122d9abea1
# 2. cd ea9cxxxx
# 3. tic tmux-256color.terminfo
set-option default-terminal "tmux-256color"
set-option -ga terminal-overrides ",*256col*:RGB"
set-option -a terminal-overrides ",alacritty:RGB"

# enable vim
# for macOS need brew install reattach-to-user-namespace
setw -g mode-keys vi # 开启vi风格后，支持vi的c-d、c-u、hjkl等快捷键
bind escape copy-mode # 绑定esc键为进入复制模式
bind -T copy-mode-vi v send-keys -X begin-selection # 绑定v键为开始选择文本
bind -T copy-mode-vi y send -X  copy-pipe-and-cancel "reattach-to-user-namespace pbcopy" \; display-message "copied to system clipboard" # 绑定y键为复制选中文本

# reload configuration
bind r source-file ~/.tmux.conf \; display '~/.tmux.conf sourced'

#===============================================================================
# navigation
#===============================================================================

# create session
bind C-c new-session

# find session
bind C-f command-prompt -p find-session 'switch-client -t %%'

# split current window horizontally
bind - split-window -v
# split current window vertically
bind | split-window -h

# pane navigation
bind -r h select-pane -L  # move left
bind -r j select-pane -D  # move down
bind -r k select-pane -U  # move up
bind -r l select-pane -R  # move right
bind > swap-pane -D       # swap current pane with the next one
bind < swap-pane -U       # swap current pane with the previous one

# pane resizing
bind -r H resize-pane -L 2
bind -r J resize-pane -D 2
bind -r K resize-pane -U 2
bind -r L resize-pane -R 2
#===============================================================================
# status-bar
# brew install tmux-mem-cpu-load
# brew install gawk coreutils
#===============================================================================
set -g status-left '   #S ❱ '
set -g status-left-length 100
#set -g status-right "#{music_status} #{artist} #{track} #{battery_status_bg} #{battery_percentage} #{battery_icon}  ❰ %a %B%e  %H:%M #[fg=#333333]#(tmux-mem-cpu-load --colors --powerline-right --interval 3 --graph-lines=0 --averages-count=0 ) #[default]"
##{network_bandwidth}
set -g status-right "#{music_status} #{artist} #{track} #{battery_status_bg}#{battery_percentage} #{battery_icon}  #{wifi_ssid} #{wifi_strength}  %a %B %e %H:%M "
set -g status-right-length 220
# 状态栏背景颜色
set -g status-bg '#333333'
# 状态栏前景颜色
set -g status-fg '#ffffff'

#===============================================================================
# plugins
# https://github.com/tmux-plugins/list
# git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
# prefix + I
# prefix + U
# prefix + alt + u
#===============================================================================
set -g @plugin 'tmux-plugins/tpm'

set -g @plugin 'tmux-plugins/tmux-battery'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'robhurring/tmux-spotify'
set -g @plugin 'gmoe/tmux-wifi'
set -g @plugin 'xamut/tmux-network-bandwidth'

# battery
set -g @batt_icon_charge_tier8 ''
set -g @batt_icon_charge_tier7 ''
set -g @batt_icon_charge_tier6 ''
set -g @batt_icon_charge_tier5 ''
set -g @batt_icon_charge_tier4 ''
set -g @batt_icon_charge_tier3 ''
set -g @batt_icon_charge_tier2 ''
set -g @batt_icon_charge_tier1 ''

set -g @batt_icon_status_charged ' '
set -g @batt_icon_status_charging ' '
set -g @batt_icon_status_discharging '​'
set -g @batt_icon_status_attached ''
set -g @batt_icon_status_unknown ''
set -g @batt_color_status_primary_charged '#3daee9'
set -g @batt_color_status_primary_charging '#3daee9'

# spotify
set -g @spotify_paused_icon "  "
set -g @spotify_playing_icon "  "
set -g @spotify_stopped_icon " "

# wifi
# 強信號: 90% ~= -55db
# 中信號: 50% ~= -75db
# 弱信號: 30% ~= -85db
# 無法使用: 8% ~= -96db
set -g @tmux_wifi_icon_5 "≣"
set -g @tmux_wifi_icon_4 "≣"
set -g @tmux_wifi_icon_3 "≡"
set -g @tmux_wifi_icon_2 "="
set -g @tmux_wifi_icon_1 "-"
set -g @tmux_wifi_icon_off "睊"

# restore neovim session
set -g @resurrect-strategy-nvim 'session'
set -g @continuum-restore 'on'
set -g @resurrect-capture-pane-contents 'on'

# initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'

